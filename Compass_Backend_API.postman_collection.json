{
	"info": {
		"_postman_id": "compass-backend-api-collection",
		"name": "Compass Backend API",
		"description": "Complete API collection for Compass Visa Application Backend\n\n## Setup Instructions\n\n1. **Set Collection Variables:**\n   - `base_url`: Your API base URL (default: http://localhost:3000)\n   - `auth_token`: Will be auto-populated after login\n\n2. **Login First:**\n   - Run the \"Login\" request in the Auth folder\n   - The token will be automatically saved to collection variables\n\n3. **Use Other APIs:**\n   - All other requests will automatically use the saved token\n\n## API Endpoints\n\n- **Auth**: Login to get access token\n- **Countries**: Browse available destination countries\n- **Visa Types**: Get visa options for a country\n- **Orders**: Create visa application orders (Individual or Group)\n- **OCR Status**: Check passport OCR processing status\n\n## File Uploads\n\nFor order creation, use `multipart/form-data` format:\n- Individual orders: Upload passport image file\n- Group orders: Upload ZIP file with traveler folders",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "compass-backend"
	},
	"item": [
		{
			"name": "Auth",
			"item": [
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.data && response.data.token) {",
									"        pm.collectionVariables.set('auth_token', response.data.token);",
									"        console.log('✅ Token saved to collection variables');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"example@leverage.com\",\n    \"password\": \"ABCD123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						},
						"description": "Login to get an access token. The token will be automatically saved to collection variables for use in other requests.\n\n**Required Fields:**\n- `email`: Partner account email\n- `password`: Partner account password\n\n**Response:**\n- Returns access token and partner account information"
					},
					"response": []
				}
			],
			"description": "Authentication endpoints for partner login"
		},
		{
			"name": "Health Check",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"health"
							]
						},
						"description": "Check if the API server is running and healthy"
					},
					"response": []
				}
			]
		},
		{
			"name": "Countries",
			"item": [
				{
					"name": "Get All Countries",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/country?page=1&page_size=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"country"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"description": "Page number (default: 1)"
								},
								{
									"key": "page_size",
									"value": "10",
									"description": "Results per page (1-100, default: 10)"
								},
								{
									"key": "search",
									"value": "",
									"description": "Search term to filter countries by name",
									"disabled": true
								}
							]
						},
						"description": "Get a list of all active countries available for visa applications.\n\n**Query Parameters:**\n- `page` (optional): Page number, default is 1\n- `page_size` (optional): Number of results per page (1-100), default is 10\n- `search` (optional): Search term to filter countries by name\n\n**Authentication:** Required (Bearer token)"
					},
					"response": []
				},
				{
					"name": "Search Countries",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/country?search=United&page=1&page_size=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"country"
							],
							"query": [
								{
									"key": "search",
									"value": "United",
									"description": "Search term"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "page_size",
									"value": "10"
								}
							]
						},
						"description": "Search for countries by name. This example searches for countries containing \"United\"."
					},
					"response": []
				}
			],
			"description": "Endpoints for browsing and searching available destination countries"
		},
		{
			"name": "Visa Types",
			"item": [
				{
					"name": "Get Visa Types by Country",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/visa/:country_id?page=1&page_size=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"visa",
								":country_id"
							],
							"query": [
								{
									"key": "page",
									"value": "1",
									"description": "Page number (default: 1)"
								},
								{
									"key": "page_size",
									"value": "10",
									"description": "Results per page (1-100, default: 10)"
								},
								{
									"key": "search",
									"value": "",
									"description": "Search term to filter visa types",
									"disabled": true
								}
							],
							"variable": [
								{
									"key": "country_id",
									"value": "",
									"description": "Country ID from the Countries API"
								}
							]
						},
						"description": "Get all visa types available for a specific country.\n\n**Path Parameters:**\n- `country_id` (required): The country ID obtained from the Countries API\n\n**Query Parameters:**\n- `page` (optional): Page number, default is 1\n- `page_size` (optional): Number of results per page (1-100), default is 10\n- `search` (optional): Search term to filter visa types\n\n**Response includes:**\n- Visa type details (name, code, description)\n- Processing times\n- Fees (base fee, service fee, taxes)\n- Required documents list\n\n**Authentication:** Required (Bearer token)"
					},
					"response": []
				}
			],
			"description": "Endpoints for retrieving visa types and their requirements for specific countries"
		},
		{
			"name": "Orders",
			"item": [
				{
					"name": "Create Individual Order",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "order_type",
									"value": "INDIVIDUAL",
									"type": "text",
									"description": "Order type: INDIVIDUAL or GROUP"
								},
								{
									"key": "visa_type_id",
									"value": "",
									"type": "text",
									"description": "Visa type ID from Visa Types API"
								},
								{
									"key": "country_id",
									"value": "",
									"type": "text",
									"description": "Country ID from Countries API"
								},
								{
									"key": "traveller_name",
									"value": "John Doe",
									"type": "text",
									"description": "Full name of the traveler"
								},
								{
									"key": "zip_file",
									"type": "file",
									"src": [],
									"description": "Passport image file (JPG, PNG, or PDF). For individual orders, you can upload a single passport image."
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/order",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"order"
							]
						},
						"description": "Create a new visa application order for a single traveler.\n\n**Required Fields:**\n- `order_type`: Must be \"INDIVIDUAL\"\n- `visa_type_id`: Visa type ID from the Visa Types API\n- `country_id`: Country ID from the Countries API\n- `traveller_name`: Full name of the traveler\n- `zip_file`: Passport image file (JPG, PNG, or PDF)\n\n**What happens:**\n- Order is created with status DOCUMENT_PENDING\n- Passport document is uploaded and saved\n- OCR processing starts automatically in the background\n- Passport information is extracted (name, number, expiry date, etc.)\n\n**File Requirements:**\n- Accepted formats: JPG, JPEG, PNG, PDF\n- Maximum size: 100 MB\n- Recommended: Keep files under 10 MB for faster processing\n\n**Authentication:** Required (Bearer token)"
					},
					"response": []
				},
				{
					"name": "Create Group Order",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "order_type",
									"value": "GROUP",
									"type": "text",
									"description": "Order type: Must be GROUP"
								},
								{
									"key": "visa_type_id",
									"value": "",
									"type": "text",
									"description": "Visa type ID from Visa Types API"
								},
								{
									"key": "country_id",
									"value": "",
									"type": "text",
									"description": "Country ID from Countries API"
								},
								{
									"key": "group_name",
									"value": "Smith Family Vacation",
									"type": "text",
									"description": "Name for the group (e.g., family name, tour group name)"
								},
								{
									"key": "travel_dates",
									"value": "2024-06-01,2024-06-15",
									"type": "text",
									"description": "Travel dates (comma-separated or JSON string)"
								},
								{
									"key": "zip_file",
									"type": "file",
									"src": [],
									"description": "ZIP file containing folders for each traveler. Each folder should be named with the traveler's name and contain their documents."
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/order",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"order"
							]
						},
						"description": "Create a new visa application order for multiple travelers (group).\n\n**Required Fields:**\n- `order_type`: Must be \"GROUP\"\n- `visa_type_id`: Visa type ID from the Visa Types API\n- `country_id`: Country ID from the Countries API\n- `group_name`: Name for the group\n- `zip_file`: ZIP file containing traveler folders\n\n**ZIP File Structure:**\n```\nsmith_family_docs.zip\n├── John_Smith/\n│   ├── passport.jpg\n│   └── photo.jpg\n├── Jane_Smith/\n│   ├── passport.jpg\n│   └── photo.jpg\n└── Emily_Smith/\n    ├── passport.jpg\n    └── photo.jpg\n```\n\n**Optional Fields:**\n- `travel_dates`: Travel dates (comma-separated or JSON string)\n\n**What happens:**\n- ZIP file is extracted\n- Each folder is treated as a separate traveler\n- Order is created with multiple travelers\n- All passport documents are processed through OCR automatically\n\n**File Requirements:**\n- ZIP file format\n- Each folder named with traveler's name\n- Documents inside each folder\n- Maximum ZIP size: 100 MB\n\n**Authentication:** Required (Bearer token)"
					},
					"response": []
				}
			],
			"description": "Endpoints for creating and managing visa application orders"
		},
		{
			"name": "OCR Status",
			"item": [
				{
					"name": "Get OCR Status by Order",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/ocr/status/:order_id",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ocr",
								"status",
								":order_id"
							],
							"variable": [
								{
									"key": "order_id",
									"value": "",
									"description": "Order ID from the Create Order response"
								}
							]
						},
						"description": "Get the OCR processing status for all travelers in an order.\n\n**Path Parameters:**\n- `order_id` (required): The order ID returned from the Create Order API\n\n**Response includes:**\n- Order ID\n- Total number of documents\n- For each traveler:\n  - Traveler ID and name\n  - Passport number (if extracted)\n  - Passport expiry date (if extracted)\n  - For each passport document:\n    - Document ID\n    - OCR status (PENDING, PROCESSING, COMPLETED, FAILED)\n    - OCR job ID\n    - Extracted passport data (if completed)\n\n**OCR Status Values:**\n- `PENDING`: OCR job submitted but not started\n- `PROCESSING`: OCR is currently analyzing the passport\n- `COMPLETED`: OCR finished successfully, data available\n- `FAILED`: OCR encountered an error\n\n**Processing Time:**\n- OCR typically completes within 5-15 seconds\n- Poll this endpoint to check when processing is done\n\n**Authentication:** Required (Bearer token)\n\n**Access Control:** You can only check status for orders you created"
					},
					"response": []
				},
				{
					"name": "Get OCR Status by Traveller",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{auth_token}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{base_url}}/ocr/status/:order_id/:traveller_id",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ocr",
								"status",
								":order_id",
								":traveller_id"
							],
							"variable": [
								{
									"key": "order_id",
									"value": "",
									"description": "Order ID from the Create Order response"
								},
								{
									"key": "traveller_id",
									"value": "",
									"description": "Traveller ID from the order"
								}
							]
						},
						"description": "Get the OCR processing status for a specific traveler in an order.\n\n**Path Parameters:**\n- `order_id` (required): The order ID\n- `traveller_id` (required): The traveler ID from the order\n\n**Response includes:**\n- Traveler ID and name\n- Passport number (if extracted)\n- Passport expiry date (if extracted)\n- For each passport document:\n  - Document ID\n  - OCR status\n  - OCR job ID\n  - Extracted passport data with full details:\n    - Passport number\n    - Full name, given names, surname\n    - Date of birth\n    - Date of expiry\n    - Nationality\n    - Validation status\n\n**Use this endpoint when:**\n- You want detailed OCR status for a specific traveler\n- You need more detailed extracted data\n\n**Authentication:** Required (Bearer token)"
					},
					"response": []
				}
			],
			"description": "Endpoints for checking passport OCR processing status and retrieving extracted data"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Auto-set base URL if not set",
					"if (!pm.collectionVariables.get('base_url')) {",
					"    pm.collectionVariables.set('base_url', 'http://localhost:3000');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Global test to check if token is set for authenticated requests",
					"const url = pm.request.url.toString();",
					"const requiresAuth = !url.includes('/auth/login') && !url.includes('/health');",
					"",
					"if (requiresAuth && !pm.collectionVariables.get('auth_token')) {",
					"    console.warn('⚠️  Warning: No auth token found. Please run the Login request first.');",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000",
			"type": "string"
		},
		{
			"key": "auth_token",
			"value": "",
			"type": "string"
		}
	]
}

